/*To test the use of a custom function as growth rate, alone or in combination with randomness. The fraction of every cell_type must match the relation between the number of operon copies they bear.
To test:
 - Change the number of operons the cells bear
 - Add randomness, either at strain level or function level
*/

include gro3

funRnd := { 0.0, 0.0 };
baseRnd := { 0.0, 0.0 };

global_params([ seed := 8685, show_plots := true ]);


//----------------------BIOCIRCUITS---------------------------
//---cells
function([ name := "fun_growth", input := {"op_A"}, params := {0.01}, rnd_params := funRnd ]);

strain([ name := "str_A"
	, growth_fun := "fun_growth"
	, growth_rate := baseRnd
	, death_threshold := -1000.0 ]);

cell_type([ name := "cell_A", strain := "str_A", plasmids := {"p_A"} ]);
cell_type([ name := "cell_AB", strain := "str_A", plasmids := { "p_A", "p_B" } ]);
cell_type([ name := "cell_ABC", strain := "str_A", plasmids := { "p_A", "p_B", "p_C" } ]);


//---elements
operon([ name := "op_A" ]);

plasmid([ name := "p_A", operons := {"op_A"} ]);
plasmid([ name := "p_B", operons := {"op_A"} ]);
plasmid([ name := "p_C", operons := {"op_A"} ]);


//------------ WORLD CONTROL -----------------------
//---placers
cell_placer([ name := "cp_A", cell_types := {"cell_A"}, amount := 10.0, coords := [ x := -200.0, y := 0.0, r := 0.0 ] ]);
cell_placer([ name := "cp_AB", cell_types := {"cell_AB"}, amount := 10.0, coords := [ x := 0.0, y := 0.0, r := 0.0 ] ]);
cell_placer([ name := "cp_ABC", cell_types := {"cell_ABC"}, amount := 10.0, coords := [ x := 200.0, y := 0.0, r := 0.0 ] ]);


//------------ VISUALS -----------------------
qgate([ name := "qga_moreThan1", input := "op_A", operator := ">" ]);
qgate([ name := "qga_lessThan3", input := "op_A", value := 3.0, operator := "<" ]);
qgate([ name := "qga_exact", input := "op_A", value := 2.0, operator := "==" ]);
bgate([ name := "ga_chain", input := { "qga_moreThan1", "qga_lessThan3" } ]);

cell_colour([ name := "ccol_blue", gate :=  "ga_chain", rgb := _blue ]);
cell_colour([ name := "ccol_green", gate := "qga_moreThan1", rgb := _green ]);
cell_colour([ name := "ccol_red", gate := "qga_lessThan3", rgb := _red ]);

//---
plot([ name := "plot_sums", fields := {"cell_A", "cell_AB", "cell_ABC"}, stats := {"sum"} ]);
plot([ name := "plot_avgs", fields := {"cell_A", "cell_AB", "cell_ABC"}, stats := "avg" ]);

pop_stat([ name := "stat_grA", gate := "cell_A", input := "_gr", stats := "avg" ]);
pop_stat([ name := "stat_grAB", gate := "cell_AB", input := "_gr", stats := "avg" ]);
pop_stat([ name := "stat_grABC", gate := "cell_ABC", input := "_gr", stats := "avg" ]);
plot([ name := "plot_gr", pop_fields := { "stat_grA", "stat_grAB", "stat_grABC" } ]);